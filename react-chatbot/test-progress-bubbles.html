<!DOCTYPE html>
<html>
<head>
    <title>Test Progress Bubbles</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f8f9fa;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .bubble {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 8px 0;
            padding: 12px 16px;
            max-width: 80%;
            animation: slideInLeft 0.3s ease-out;
            opacity: 0.85;
        }
        .bubble.animating {
            animation: slideInLeft 0.3s ease-out, pulse 2s infinite 0.3s;
        }
        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 0.85; transform: translateX(0); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 0.6; }
        }
        .bubble-avatar {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            animation: rotate 3s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .bubble-content {
            flex: 1;
            background-color: #ffffff;
            border: 2px dashed #007bff;
            border-radius: 18px 18px 18px 4px;
            padding: 12px 16px;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }
        .bubble-content::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 16px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 6px 8px 6px 0;
            border-color: transparent #007bff transparent transparent;
        }
        .bubble-content::after {
            content: '';
            position: absolute;
            left: -6px;
            top: 17px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 5px 7px 5px 0;
            border-color: transparent #ffffff transparent transparent;
        }

        .bubble-text {
            color: #212529;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        .dots {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-top: 8px;
        }
        .dots span {
            width: 6px;
            height: 6px;
            background-color: #007bff;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .dots span:nth-child(1) { animation-delay: -0.32s; }
        .dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 6px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .demo-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó®Ô∏è Progress Bubbles Demo</h1>
        <p>This demonstrates the new streaming progress UI with individual speech bubbles.</p>
        
        <button onclick="simulateStreaming()">‚ñ∂Ô∏è Simulate Streaming</button>
        <button onclick="clearBubbles()">üóëÔ∏è Clear Bubbles</button>
        
        <div class="demo-area" id="bubbleContainer">
            <p style="text-align: center; color: #6c757d; margin-top: 80px;">
                Click "Simulate Streaming" to see the progress bubbles in action
            </p>
        </div>
    </div>

    <script>
        let bubbleCounter = 0;

        function createBubble(content, type, icon, isAnimating = false) {
            const container = document.getElementById('bubbleContainer');
            
            const bubble = document.createElement('div');
            bubble.className = `bubble ${isAnimating ? 'animating' : ''}`;
            bubble.innerHTML = `
                <div class="bubble-avatar">
                    <span>${icon}</span>
                </div>
                <div class="bubble-content">
                    <div class="bubble-text">${content}</div>
                    ${isAnimating ? '<div class="dots"><span></span><span></span><span></span></div>' : ''}
                </div>
            `;
            
            container.appendChild(bubble);
            return bubble;
        }

        function clearBubbles() {
            const container = document.getElementById('bubbleContainer');
            container.innerHTML = '<p style="text-align: center; color: #6c757d; margin-top: 80px;">Click "Simulate Streaming" to see the progress bubbles in action</p>';
        }

        async function simulateStreaming() {
            clearBubbles();
            
            // Step 1: Connecting
            const connectBubble = createBubble(
                'Connecting to AI assistant...', 
                'Processing', 
                '‚öôÔ∏è', 
                true
            );
            
            await sleep(1000);
            
            // Step 2: Assistant Response
            createBubble(
                'The patient\\'s age is 75.83 years old.', 
                'Assistant Response', 
                'üí≠'
            );
            
            await sleep(800);
            
            // Step 3: Logical Extraction
            createBubble(
                'Extracted: (= age 75.83287671232877)', 
                'Logical Extraction', 
                'üß†'
            );
            
            await sleep(1200);
            
            // Step 4: Validation
            createBubble(
                'Validation: ‚úÖ Valid | Times: extraction: 2.67s, theorem prover: 0.15s', 
                'Validation', 
                'üîç'
            );
            
            await sleep(1500);
            
            // Remove all bubbles (simulate completion)
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach((bubble, index) => {
                setTimeout(() => {
                    bubble.style.animation = 'fadeOut 0.5s ease-out forwards';
                    setTimeout(() => bubble.remove(), 500);
                }, index * 100);
            });
            
            // Show completion message
            setTimeout(() => {
                const container = document.getElementById('bubbleContainer');
                container.innerHTML = '<p style="text-align: center; color: #28a745; margin-top: 80px; font-weight: 600;">‚úÖ Streaming completed! Final response would appear as a regular message.</p>';
            }, 2000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Add fadeOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 0.85; transform: translateX(0); }
                to { opacity: 0; transform: translateX(-20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>